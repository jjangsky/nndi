<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
 <mapper namespace="com.nndi.client.board.UserBoardMapper">
 	<!-- BoardAndCategoryDTO -->
 	<resultMap type="com.nndi.model.joindto.client.board.BoardAndCategoryDTO" id="BoardAndCategoryResultMap">
 		<id property="num" column="NUM"/>
 		<result property="cate" column="CATE_NUM"/>
 		<result property="memberId" column="MEM_ID"/>
 		<result property="managerId" column="MANAGER_ID"/>
 		<result property="date" column="POST_DATE"/>
 		<result property="title" column="TITLE"/>
 		<result property="content" column="CONTENT"/>
 		<result property="answer" column="ANSWER_YN"/>
 		<result property="answerContent" column="ANSWER_CONTENT"/>
 		<result property="display" column="DISPLAY_YN"/>
 		<result property="hits" column="HITS"/>
 		<association property="category" javaType="com.nndi.model.commondto.PostCategoryDTO">
 			<id property="cateNum" column="CATE_NUM"/>
 			<result property="cateKind" column="CATE_KIND"/>
 		</association>
 	</resultMap>
 	
 	<!-- boardDTO -->
 	<resultMap type="com.nndi.model.commondto.BoardDTO" id="boardResultMap">
 		<id property="num" column="NUM"/>
 		<result property="cate" column="CATE_NUM"/>
 		<result property="memberId" column="MEM_ID"/>
 		<result property="managerId" column="MANAGER_ID"/>
 		<result property="date" column="POST_DATE"/>
 		<result property="title" column="TITLE"/>
 		<result property="content" column="CONTEN reT"/>
 		<result property="answer" column="ANSWER_YN"/>
 		<result property="answerContent" column="ANSWER_CONTENT"/>
 		<result property="display" column="DISPLAY_YN"/>
 		<result property="hits" column="HITS"/>
 	</resultMap>
 
 	<!-- NoticeDTO -->
	  <resultMap type="com.nndi.model.commondto.NoticeDTO" id="NoticeResultMap">
	  	<id property="num" column="NUM"/>
	  	<result property="managerId" column="MANAGER_ID"/>
	  	<result property="cateNum" column="CATE_NUM"/>
	  	<result property="postDate" column="POST_DATE"/>
	  	<result property="title" column="TITLE"/>
	  	<result property="content" column="CONTENT"/>
	  	<result property="hits" column="HITS"/>
	  	<result property="uploadFileKey" column="UPLOAD_FILE_KEY"/>
	  </resultMap>
 	
 	<!--  민원 전체 조회 쿼리 -->
 	<select id="selectBoardList" resultMap="BoardAndCategoryResultMap">
 		SELECT
               A.NUM
             , A.CATE_NUM
             , A.MEM_ID
             , A.MANAGER_ID
             , A.POST_DATE
             , A.TITLE
             , A.CONTENT
             , A.ANSWER_YN
             , A.ANSWER_CONTENT
             , A.DISPLAY_YN
             , A.HITS
             , B.CATE_NUM
             , B.CATE_KIND
          FROM TBL_POST_COMPLAIN A
          JOIN TBL_POST_CATEGORY B ON (A.CATE_NUM = B.CATE_NUM)
        ORDER BY NUM DESC
 	</select>
 	<!-- 민원 신청 쿼리 -->
 	<insert id="insertComplain" parameterType="com.nndi.model.commondto.BoardDTO">
 		
 		INSERT 
               INTO TBL_POST_COMPLAIN
        VALUES
        (
          SEQ_COMPLAIN_POST_NUM.NEXTVAL
        , #{ cate }
        , #{ memberId }
        , NULL
        , TO_DATE(SYSDATE,'YYYY.MM.DD HH24:MI')
        , #{ title }
        , #{ content }
        , 'N'
        , NULL
        , 'Y'
        , '0'
        )
 	</insert>
 	
 	<!-- 민원 상세 조회 쿼리 -->
 	<select id="complainDetail" parameterType="_int" resultMap="BoardAndCategoryResultMap">
 		SELECT
               A.NUM
             , A.CATE_NUM
             , A.MEM_ID
             , A.MANAGER_ID
             , A.POST_DATE
             , A.TITLE
             , A.CONTENT
             , A.ANSWER_YN
             , A.ANSWER_CONTENT
             , A.DISPLAY_YN
             , A.HITS
             , B.CATE_NUM
             , B.CATE_KIND
          FROM TBL_POST_COMPLAIN A
          JOIN TBL_POST_CATEGORY B ON (A.CATE_NUM = B.CATE_NUM)
         WHERE A.NUM = #{ num }
 	</select>
 	
 	<!-- 민원 수정 쿼리 -->
 	<update id="updateComplain" parameterType="com.nndi.model.commondto.BoardDTO">
 		UPDATE
               TBL_POST_COMPLAIN A
           SET A.CATE_NUM = #{ cate }
             , A.TITLE = #{ title }
             , A.CONTENT = #{ content }
         WHERE A.NUM = #{ num }
 	
 	</update>
 	
 	<!-- 공지사항 전체 조회 쿼리 -->
 	<select id="selectNotice" resultMap="NoticeResultMap">
 		SELECT
               A.NUM
             , A.MANAGER_ID
             , A.CATE_NUM
             , A.POST_DATE
             , A.TITLE
             , A.CONTENT
             , A.HITS
             , A.UPLOAD_FILE_KEY
          FROM TBL_POST_NOTICE A
 	</select>
 	
 	<!-- 공지사항 상세 조회 쿼리 -->
 	<select id="selectNoticeDetail" parameterType="_int" resultMap="NoticeResultMap">
 		SELECT
               A.NUM
             , A.MANAGER_ID
             , A.CATE_NUM
             , A.POST_DATE
             , A.TITLE
             , A.CONTENT
             , A.HITS
             , A.UPLOAD_FILE_KEY
          FROM TBL_POST_NOTICE A
         WHERE A.NUM = #{ num }
 	</select>
 	
 	<!-- 민원 게시판 삭제(컬럼값 변경)  -->
 	<update id="deleteComplain" parameterType="_int">
 		UPDATE
               TBL_POST_COMPLAIN A
           SET A.DISPLAY_YN = 'N'
         WHERE A.NUM = #{ num }
 	</update>
 	
 	<!--  민원게시판 답변 상세조회 쿼리 -->
    <select id="selectComplainAnswer" parameterType="_int" resultMap="BoardAndCategoryResultMap">
 		SELECT
               A.NUM
             , A.CATE_NUM
             , A.MEM_ID
             , A.MANAGER_ID
             , A.POST_DATE
             , A.TITLE
             , A.CONTENT
             , A.ANSWER_YN
             , A.ANSWER_CONTENT
             , A.DISPLAY_YN
             , A.HITS
             , B.CATE_NUM
             , B.CATE_KIND
          FROM TBL_POST_COMPLAIN A
          JOIN TBL_POST_CATEGORY B ON (A.CATE_NUM = B.CATE_NUM)
         WHERE A.NUM = #{ num }
 	</select> 
 	
 	<!-- 공지사항 조회수 증가 쿼리문 -->
 	<update id="incrementNoticeCount" parameterType="_int">
 		UPDATE
               TBL_POST_NOTICE A
 		   SET A.HITS = (SELECT B.HITS
 		                   FROM TBL_POST_NOTICE B
 		                  WHERE B.NUM = #{ num }
 		                ) +1
  		WHERE A.NUM = #{ num }
 		  
 	</update>
 	
 	
 
 </mapper>